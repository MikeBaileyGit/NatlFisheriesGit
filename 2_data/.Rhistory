monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
monthly$USDAxVolume100k = monthly$USDA01 * monthly$import_volume_100k
monthly$USDAxVolume1M = monthly$USDA01 * monthly$import_volume_1M
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset.RData")
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish_food_refusal, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','fs_refusals'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$fs_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','fs_refusals'))
View(monthly)
View(monthlyRef)
# Limit to observations with import volume
monthly = merge(x= monthly, y= monthlyRef, by= c('yrmonth','country'), all.x= TRUE, fill= 0)
View(monthly)
monthly[is.na(monthly)] = 0
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset.RData")
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
View(monthly)
## Base Model
ols.3 = lm(fs_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.3)
save(ols.3, file="output/analysis/ve_analysis_3_ols.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Base Model
ols.2 = lm(total_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.2)
save(ols.2, file="output/analysis/ve_analysis_2_ols.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
View(composite)
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$refusal_weight, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','refusal_weight'))
View(monthly)
View(monthly)
View(monthlyRef)
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$fs_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','fs_refusals'))
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$refusal_weight), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','refusal_weight'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$refusal_weight), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','refusal_weight'))
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$refusal_weight, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','refusal_weight'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$refusal_weight), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','refusal_weight'))
# Limit to observations with import volume
monthly = merge(x= monthly, y= monthlyRef, by= c('yrmonth','country'), all.x= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
View(monthly)
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Base Model
ols.4 = lm(refusal_weight ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.4)
save(ols.4, file="output/analysis/ve_analysis_4_ols.RData")
monthly$refusal_weight_1M = monthly$refusal_weight / 1000000
## Base Model
ols.4 = lm(refusal_weight_1M ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
## Base Model
ols.4 = lm(refusal_weight_1M ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.4)
save(ols.4, file="output/analysis/ve_analysis_4_ols.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
monthly$refusalByVolume = monthly$total_refusal_weight / monthly$import_volume
## Visualization
```{r}
monthly$relevantCountries = ifelse((monthly$country == "VIETNAM" | monthly$country == "CHINA" | monthly$country == "THAILAND"), monthly$country, "All Other Countries")
visualize = setNames(aggregate(monthly$refusal_weight, by=list(monthly$yrmonth, monthly$relevantCountries), FUN= mean), c('yrmonth','country','refusal_weight'))
## Monthly refusals over time period (Vietnam)
ggplot(visualize, aes(x= yrmonth, y= refusal_weight, group= country, fill= country)) +
geom_line() +
labs(x= "Year-Month", y= "Proportion of Refusals by Volume", title= "Catfish Import Refusals Proportion of Volume\nfrom January 2014 to February 2020") +
theme(axis.text.x= element_text(angle= 90, vjust= 0.5))+
geom_vline(xintercept= "2016-03", linetype= "dashed", color= "darkred") + annotate("text", x= "2016-04", y= 0.01, color= "darkred", label= "March 2016\nRegulatory power shifts to USDA", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2017-09", linetype= "dashed", color= "darkred") + annotate("text", x= "2017-10", y= 0.01, color= "darkred", label= "September 2017\n18 month transition period ends", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2019-11", linetype= "dashed", color= "darkred") + annotate("text", x= "2019-12", y= 0.01, color= "darkred", label= "November 2019\nVietnam gains FSIS\nequivalence", hjust= 0, vjust= 1)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
## Monthly refusals over time period (Vietnam)
ggplot(visualize, aes(x= yrmonth, y= refusal_weight, group= country, fill= country)) +
geom_line() +
labs(x= "Year-Month", y= "Weight of Refusals (kg)", title= "Weight Catfish Import Refusals Proportion of Volume\nfrom January 2014 to February 2020") +
theme(axis.text.x= element_text(angle= 90, vjust= 0.5))+
geom_vline(xintercept= "2016-03", linetype= "dashed", color= "darkred") + annotate("text", x= "2016-04", y= 0.01, color= "darkred", label= "March 2016\nRegulatory power shifts to USDA", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2017-09", linetype= "dashed", color= "darkred") + annotate("text", x= "2017-10", y= 0.01, color= "darkred", label= "September 2017\n18 month transition period ends", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2019-11", linetype= "dashed", color= "darkred") + annotate("text", x= "2019-12", y= 0.01, color= "darkred", label= "November 2019\nVietnam gains FSIS\nequivalence", hjust= 0, vjust= 1)
View(visualize)
visualize = visualize[visualize$year >= 2014 & !(monthly$month == '01' | monthly$month == '02'),]
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
monthly$relevantCountries = ifelse((monthly$country == "VIETNAM" | monthly$country == "CHINA" | monthly$country == "THAILAND"), monthly$country, "All Other Countries")
visualize = setNames(aggregate(monthly$refusal_weight, by=list(monthly$yrmonth, monthly$relevantCountries), FUN= mean), c('yrmonth','country','refusal_weight'))
visualize = visualize[visualize$year >= 2014 & !(visualize$month == '01' | visualize$month == '02'),]
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
monthly$relevantCountries = ifelse((monthly$country == "VIETNAM" | monthly$country == "CHINA" | monthly$country == "THAILAND"), monthly$country, "All Other Countries")
visualize = setNames(aggregate(monthly$refusal_weight, by=list(monthly$yrmonth, monthly$relevantCountries), FUN= mean), c('yrmonth','country','refusal_weight'))
visualize = visualize[visualize$year >= 2015,]
monthly$relevantCountries = ifelse((monthly$country == "VIETNAM" | monthly$country == "CHINA" | monthly$country == "THAILAND"), monthly$country, "All Other Countries")
visualize = setNames(aggregate(monthly$refusal_weight, by=list(monthly$yrmonth, monthly$relevantCountries), FUN= mean), c('yrmonth','country','refusal_weight'))
visualize = visualize[visualize$year >= 2015,]
visualize = visualize[visualize$yrmonth >= 2015,]
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
monthly$relevantCountries = ifelse((monthly$country == "VIETNAM" | monthly$country == "CHINA" | monthly$country == "THAILAND"), monthly$country, "All Other Countries")
visualize = setNames(aggregate(monthly$refusal_weight, by=list(monthly$yrmonth, monthly$relevantCountries), FUN= mean), c('yrmonth','country','refusal_weight'))
visualize = visualize[visualize$yrmonth >= 2015,]
View(visualize)
## Monthly refusals over time period (Vietnam)
ggplot(visualize, aes(x= yrmonth, y= refusal_weight, group= country, fill= country)) +
geom_line() +
labs(x= "Year-Month", y= "Weight of Refusals (kg)", title= "Weight Catfish Import Refusals Proportion of Volume\nfrom January 2014 to February 2020") +
theme(axis.text.x= element_text(angle= 90, vjust= 0.5))+
geom_vline(xintercept= "2016-03", linetype= "dashed", color= "darkred") + annotate("text", x= "2016-04", y= 0.01, color= "darkred", label= "March 2016\nRegulatory power shifts to USDA", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2017-09", linetype= "dashed", color= "darkred") + annotate("text", x= "2017-10", y= 0.01, color= "darkred", label= "September 2017\n18 month transition period ends", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2019-11", linetype= "dashed", color= "darkred") + annotate("text", x= "2019-12", y= 0.01, color= "darkred", label= "November 2019\nVietnam gains FSIS\nequivalence", hjust= 0, vjust= 1)
## Monthly refusals over time period (Vietnam)
ggplot(visualize, aes(x= yrmonth, y= refusal_weight, group= country, fill= country)) +
geom_line() +
labs(x= "Year-Month", y= "Weight of Refusals (kg)", title= "Weight Catfish Import Refusals Proportion of Volume\nfrom January 2014 to February 2020") +
theme(axis.text.x= element_text(angle= 90, vjust= 0.5))+
geom_vline(xintercept= "2016-03", linetype= "dashed", color= "darkred") + annotate("text", x= "2016-04", y= 100000, color= "darkred", label= "March 2016\nRegulatory power shifts to USDA", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2017-09", linetype= "dashed", color= "darkred") + annotate("text", x= "2017-10", y= 100000, color= "darkred", label= "September 2017\n18 month transition period ends", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2019-11", linetype= "dashed", color= "darkred") + annotate("text", x= "2019-12", y= 100000, color= "darkred", label= "November 2019\nVietnam gains FSIS\nequivalence", hjust= 0, vjust= 1)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(devtools)
install_github("dgrtwo/broom")
library(broom)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(knitr)
library(car)
library(AER)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Cleaned import volume data
import = read.csv("output/build/monthly_cleaned.csv")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','total_refusals'))
## Create Year-Month variable for aggregation
import$yrmonth = format(as.Date(paste(import$year,import$month_number,"01", sep="-")),"%Y-%m")
## Aggregate refusals to a monthly level
monthlyVol = setNames(aggregate(import$volume_kg, by=list(import$yrmonth, import$country_name), FUN= sum), c('yrmonth','country','import_volume'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$total_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','total_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthlyRef, y= monthlyVol, by= c('yrmonth','country'), all.y= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
monthly$import_volume_100k = monthly$import_volume / 100000
monthly$import_volume_1M   = monthly$import_volume / 1000000
## Month & Year variables
typeof(monthly$yrmonth)
monthly$year = format(as.Date(paste(monthly$yrmonth,'-01',sep= '')), '%Y')
monthly$month = format(as.Date(paste(monthly$yrmonth,'-01',sep = '')), '%m')
typeof(monthly$year)
## Limit data to 2014 (FDA start) to 2020 February (USDA end)
monthly = monthly[monthly$year >= 2014,]
monthly = monthly[!(monthly$year == 2020 & !(monthly$month == '01' | monthly$month == '02')),]
monthly = monthly %>%
mutate(USDA_transition01 = ifelse((yrmonth >= as.yearmon("2016-03")) & (yrmonth < as.yearmon("2017-09")), 1, 0),
USDA01 = ifelse(yrmonth > as.yearmon("2017-08"), 1, 0))
## Interaction of USDA Authority and Volume
monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
monthly$USDAxVolume100k = monthly$USDA01 * monthly$import_volume_100k
monthly$USDAxVolume1M = monthly$USDA01 * monthly$import_volume_1M
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(knitr)
library(car)
library(AER)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish_food_refusal, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','fs_refusals'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$fs_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','fs_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthly, y= monthlyRef, by= c('yrmonth','country'), all.x= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset_2.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset_2.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(knitr)
library(car)
library(AER)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset_2.Rdata")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$refusal_weight, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','refusal_weight'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$refusal_weight), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','refusal_weight'))
# Limit to observations with import volume
monthly = merge(x= monthly, y= monthlyRef, by= c('yrmonth','country'), all.x= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset_3.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset_3.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(tidyverse)
install.packages("backports")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
install.packages("backports")
install.packages("broom")
library(tidyverse)
library(tidyverse)
library(tidyverse)
install.packages("tidverse")
install.packages("tidyverse")
library(tidyverse)
library(tidyverse)
library("tidyverse")
library(tidyverse)
library(tidyverse)
install.packages("broom")
library(tidyverse)
install.packages("tidyverse")
library(tidyverse)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset_2.Rdata")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset_2.Rdata")
## Base Model
ols.3 = lm(fs_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.3)
save(ols.3, file="output/analysis/ve_analysis_3_ols.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset_3.Rdata")
monthly$refusal_weight_1M = monthly$refusal_weight / 1000000
## Base Model
ols.4 = lm(refusal_weight_1M ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.4)
save(ols.4, file="output/analysis/ve_analysis_4_ols.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(broom)
library(stargazer)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Base Model
ols.2 = lm(total_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.2)
save(ols.2, file="output/analysis/ve_analysis_2_ols.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(stargazer)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Base Model
ols.1 = lm(total_refusals ~ USDA01, data= monthly)
summary(ols.1)
save(ols.1, file="output/analysis/ve_analysis_1_ols.RData")
stargazer(ols.1, title="Results", align=TRUE)
View(ols.1)
View(ols.2)
View(ols.3)
View(ols.3)
View(ols.4)
View(ols.3)
View(ols.2)
View(ols.3)
View(ols.3)
View(ols.2)
View(ols.1)
View(ols.2)
View(ols.3)
