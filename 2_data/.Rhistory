library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Cleaned import volume data
import = read.csv("output/build/monthly_cleaned.csv")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','total_refusals'))
## Create Year-Month variable for aggregation
import$yrmonth = format(as.Date(paste(import$year,import$month_number,"01", sep="-")),"%Y-%m")
## Aggregate refusals to a monthly level
monthlyVol = setNames(aggregate(import$volume_kg, by=list(import$yrmonth, import$country_name), FUN= sum), c('yrmonth','country','import_volume'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$total_refusals[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$total_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','total_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthlyRef, y= monthlyVol, by= c('yrmonth','country'), all.y= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Month & Year variables
typeof(monthly$yrmonth)
monthly$year = format(as.Date(paste(monthly$yrmonth,'-01',sep= '')), '%Y')
monthly$month = format(as.Date(paste(monthly$yrmonth,'-01',sep = '')), '%m')
typeof(monthly$year)
## Limit data to 2014 (FDA start) to 2020 February (USDA end)
monthly = monthly[monthly$year >= 2014,]
monthly = monthly[!(monthly$year == 2020 & !(monthly$month == '01' | monthly$month == '02')),]
## Dummy Variable if month year is in or after September 2017
monthly$USDA01 = ifelse(((monthly$year == 2017 & (monthly$month == "09" | monthly$month == "10" | monthly$month == "11" | monthly$month == "12"))
| monthly$year >= 2018), 1, 0)
## Interaction of USDA Authority and Volume
monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
## Base Model
ols.1 = lm(total_refusals ~ import_volume + USDA01 + USDAxVolume +  factor(month) + factor(country), data= monthly)
summary(ols.1)
monthly$refusalByVolume = monthly$total_refusals / monthly$import_volume
monthly[is.na(monthly)] = 0
monthly$relevantCountries = ifelse((monthly$country == "VIETNAM" | monthly$country == "CHINA" | monthly$country == "THAILAND"), monthly$country, "All Other Countries")
visualize = setNames(aggregate(monthly$refusalByVolume, by=list(monthly$yrmonth, monthly$relevantCountries), FUN= mean), c('yrmonth','country','refusalsByVolume'))
## Monthly refusals over time period (Vietnam)
ggplot(visualize, aes(x= yrmonth, y= refusalsByVolume, group= country, fill= country)) +
geom_line() +
labs(x= "Year-Month", y= "Proportion of Refusals by Volume", title= "Catfish Import Refusals Proportion of Volume\nfrom January 2014 to February 2020") +
theme(axis.text.x= element_text(angle= 90, vjust= 0.5))+
geom_vline(xintercept= "2016-03", linetype= "dashed", color= "darkred") + annotate("text", x= "2016-04", y= 0.01, color= "darkred", label= "March 2016\nRegulatory power shifts to USDA", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2017-09", linetype= "dashed", color= "darkred") + annotate("text", x= "2017-10", y= 0.01, color= "darkred", label= "September 2017\n18 month transition period ends", hjust= 0, vjust= 1) +
geom_vline(xintercept= "2019-11", linetype= "dashed", color= "darkred") + annotate("text", x= "2019-12", y= 0.01, color= "darkred", label= "November 2019\nVietnam gains FSIS\nequivalence", hjust= 0, vjust= 1)
# Load packages used
library(knitr)
library(car)
library(AER)
library(dplyr)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
# Set up
opts_chunk$set(echo = TRUE)
options(digits = 3)
opts_knit$set(root.dir ="~/Desktop/NatlFisheriesGit/2_data")
# Remove objects from the previous session
rm(list = ls(all = TRUE))
# Load the import data
import <- read.csv("output/build/monthly_cleaned.csv")
import = subset(import, select = -c(X))
import$year_month <- as.yearmon(paste(import$year, import$month), "%Y %B")
import = as_tibble(import)
import
# Subset to Vietnam
import_VN = import %>%
group_by(year_month, country_name) %>%
summarise(volume_sum = sum(volume_kg),
value_sum = sum(value_USD)) %>%
filter(country_name %in% c("VIETNAM"))
# Subset to Vietnam
import_VN = import %>%
group_by(year_month, country_name) %>%
summarise(volume_sum = sum(volume_kg),
value_sum = sum(value_USD)) %>%
dplyr::filter(country_name %in% c("VIETNAM"))
# Load the refusal data
load("output/build/compositeImportRefusal.Rdata")
refusal = as_tibble(composite) %>%
filter(catfish == 1) %>%
arrange(date)
refusal
import_all = import %>%
group_by(year_month, country_name) %>%
summarise(volume_sum = sum(volume_kg),
value_sum = sum(value_USD))
import_all
refusal_all = refusal %>%
mutate(year_month = as.yearmon(date, "%Y %B")) %>%
group_by(year_month, country_std) %>%
summarise(refusal_count = n())
refusal_all = refusal %>%
mutate(year_month = as.yearmon(date, "%Y %B")) %>%
group_by(year_month, country_std) %>%
dplyr::summarise(refusal_count = n())
refusal_all
dta = import_all %>%
full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
filter(year_month > as.yearmon("2013-12")) %>%
filter(year_month < as.yearmon("2020-03")) %>%
mutate(USDA_dummy = ifelse(year_month > as.yearmon("2016-02"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
replace_na(list(refusal_count = 0))
dta = import_all %>%
dplyr::full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
dplyr::filter(year_month > as.yearmon("2013-12")) %>%
dplyr::filter(year_month < as.yearmon("2020-03")) %>%
dplyr::mutate(USDA_dummy = ifelse(year_month > as.yearmon("2016-02"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
dplyr::replace_na(list(refusal_count = 0))
View(import_all)
View(import)
# Load the import data
import <- read.csv("output/build/monthly_cleaned.csv")
import = subset(import, select = -c(X))
import$year_month <- as.yearmon(paste(import$year, import$month), "%Y %B")
import = as_tibble(import)
import
View(import)
import_all = import %>%
group_by(year_month, country_name) %>%
summarise(volume_sum = sum(volume_kg),
value_sum = sum(value_USD))
import_all
import_all = import %>%
dplyr::group_by(year_month, country_name) %>%
dplyr::summarise(volume_sum = sum(volume_kg),
value_sum = sum(value_USD))
import_all
refusal_all = refusal %>%
mutate(year_month = as.yearmon(date, "%Y %B")) %>%
group_by(year_month, country_std) %>%
dplyr::summarise(refusal_count = n())
refusal_all
dta = import_all %>%
dplyr::full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
dplyr::filter(year_month > as.yearmon("2013-12")) %>%
dplyr::filter(year_month < as.yearmon("2020-03")) %>%
dplyr::mutate(USDA_dummy = ifelse(year_month > as.yearmon("2016-02"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
dplyr::replace_na(list(refusal_count = 0))
dta = import_all %>%
dplyr::full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
dplyr::filter(year_month > as.yearmon("2013-12")) %>%
dplyr::filter(year_month < as.yearmon("2020-03")) %>%
dplyr::mutate(USDA_dummy = ifelse(year_month > as.yearmon("2016-02"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
replace_na(list(refusal_count = 0))
dta
#write.csv(dta,"output/build/ez_merged_data.csv")
# Add factor(country_name)
OLS.4 <- lm(refusal_count ~ USDA_dummy + volume_sum + USDAxVolume + factor(month) + factor(country_name),
data = dta)
# Create an interaction variable
dta$USDAxVolume = dta$USDA_dummy * dta$volume_sum
# Add factor(country_name)
OLS.4 <- lm(refusal_count ~ USDA_dummy + volume_sum + USDAxVolume + factor(month) + factor(country_name),
data = dta)
summ(OLS.4, digits = 3)
summ(OLS.4, digits = 10)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=10)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Cleaned import volume data
import = read.csv("output/build/monthly_cleaned.csv")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','total_refusals'))
## Create Year-Month variable for aggregation
import$yrmonth = format(as.Date(paste(import$year,import$month_number,"01", sep="-")),"%Y-%m")
## Aggregate refusals to a monthly level
monthlyVol = setNames(aggregate(import$volume_kg, by=list(import$yrmonth, import$country_name), FUN= sum), c('yrmonth','country','import_volume'))
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$total_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','total_refusals'))
View(monthlyRef)
# Limit to observations with import volume
monthly = merge(x= monthlyRef, y= monthlyVol, by= c('yrmonth','country'), all.y= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Month & Year variables
typeof(monthly$yrmonth)
monthly$year = format(as.Date(paste(monthly$yrmonth,'-01',sep= '')), '%Y')
monthly$month = format(as.Date(paste(monthly$yrmonth,'-01',sep = '')), '%m')
typeof(monthly$year)
## Limit data to 2014 (FDA start) to 2020 February (USDA end)
monthly = monthly[monthly$year >= 2014,]
monthly = monthly[!(monthly$year == 2020 & !(monthly$month == '01' | monthly$month == '02')),]
## Dummy Variable if month year is in or after September 2017
monthly$USDA01 = ifelse(((monthly$year == 2017 & (monthly$month == "09" | monthly$month == "10" | monthly$month == "11" | monthly$month == "12"))
| monthly$year >= 2018), 1, 0)
## Interaction of USDA Authority and Volume
monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
## Base Model
ols.1 = lm(total_refusals ~ import_volume + USDA01 + USDAxVolume +  factor(month) + factor(country), data= monthly)
summary(ols.1)
summary(OLS.4, digits = 10)
# Load packages used
library(knitr)
library(car)
library(AER)
library(dplyr)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
# Set up
opts_chunk$set(echo = TRUE)
options(digits = 3)
opts_knit$set(root.dir ="~/Desktop/NatlFisheriesGit/2_data")
# Remove objects from the previous session
rm(list = ls(all = TRUE))
# Load the import data
import <- read.csv("output/build/monthly_cleaned.csv")
import = subset(import, select = -c(X))
import$year_month <- as.yearmon(paste(import$year, import$month), "%Y %B")
import = as_tibble(import)
import
# Subset to Vietnam
import_VN = import %>%
group_by(year_month, country_name) %>%
summarise(volume_sum = sum(volume_kg),
value_sum = sum(value_USD)) %>%
filter(country_name %in% c("VIETNAM"))
import_all = import %>%
dplyr::group_by(year_month, country_name) %>%
dplyr::summarise(volume_sum = sum(volume_kg),
value_sum = sum(value_USD))
import_all
dta = import_all %>%
dplyr::full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
dplyr::filter(year_month > as.yearmon("2013-12")) %>%
dplyr::filter(year_month < as.yearmon("2020-03")) %>%
dplyr::mutate(USDA_dummy = ifelse(year_month > as.yearmon("2016-02"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
replace_na(list(refusal_count = 0))
refusal_all = refusal %>%
mutate(year_month = as.yearmon(date, "%Y %B")) %>%
group_by(year_month, country_std) %>%
dplyr::summarise(refusal_count = n())
# Load the refusal data
load("output/build/compositeImportRefusal.Rdata")
refusal = as_tibble(composite) %>%
filter(catfish == 1) %>%
arrange(date)
refusal
refusal_all = refusal %>%
mutate(year_month = as.yearmon(date, "%Y %B")) %>%
group_by(year_month, country_std) %>%
dplyr::summarise(refusal_count = n())
refusal_all
dta = import_all %>%
dplyr::full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
dplyr::filter(year_month > as.yearmon("2013-12")) %>%
dplyr::filter(year_month < as.yearmon("2020-03")) %>%
dplyr::mutate(USDA_dummy = ifelse(year_month > as.yearmon("2016-02"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
replace_na(list(refusal_count = 0))
dta
#write.csv(dta,"output/build/ez_merged_data.csv")
# Add factor(country_name)
OLS.4 <- lm(refusal_count ~ USDA_dummy + volume_sum + USDAxVolume + factor(month) + factor(country_name),
data = dta)
# Create an interaction variable
dta$USDAxVolume = dta$USDA_dummy * dta$volume_sum
dta = import_all %>%
dplyr::full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
dplyr::filter(year_month > as.yearmon("2013-12")) %>%
dplyr::filter(year_month < as.yearmon("2020-03")) %>%
dplyr::mutate(USDA_dummy = ifelse(year_month > as.yearmon("2017-03"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
replace_na(list(refusal_count = 0))
dta
#write.csv(dta,"output/build/ez_merged_data.csv")
# Add factor(country_name)
OLS.4 <- lm(refusal_count ~ USDA_dummy + volume_sum + USDAxVolume + factor(month) + factor(country_name),
data = dta)
# Create an interaction variable
dta$USDAxVolume = dta$USDA_dummy * dta$volume_sum
# Add factor(country_name)
OLS.4 <- lm(refusal_count ~ USDA_dummy + volume_sum + USDAxVolume + factor(month) + factor(country_name),
data = dta)
summary(OLS.4, digits = 10)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Cleaned import volume data
import = read.csv("output/build/monthly_cleaned.csv")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','total_refusals'))
## Create Year-Month variable for aggregation
import$yrmonth = format(as.Date(paste(import$year,import$month_number,"01", sep="-")),"%Y-%m")
## Aggregate refusals to a monthly level
monthlyVol = setNames(aggregate(import$volume_kg, by=list(import$yrmonth, import$country_name), FUN= sum), c('yrmonth','country','import_volume'))
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$total_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','total_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthlyRef, y= monthlyVol, by= c('yrmonth','country'), all.y= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Month & Year variables
typeof(monthly$yrmonth)
monthly$year = format(as.Date(paste(monthly$yrmonth,'-01',sep= '')), '%Y')
monthly$month = format(as.Date(paste(monthly$yrmonth,'-01',sep = '')), '%m')
typeof(monthly$year)
## Limit data to 2014 (FDA start) to 2020 February (USDA end)
monthly = monthly[monthly$year >= 2014,]
monthly = monthly[!(monthly$year == 2020 & !(monthly$month == '01' | monthly$month == '02')),]
## Dummy Variable if month year is in or after September 2017
monthly$USDA01 = ifelse(((monthly$year == 2017 & (monthly$month == "09" | monthly$month == "10" | monthly$month == "11" | monthly$month == "12"))
| monthly$year >= 2018), 1, 0)
## Interaction of USDA Authority and Volume
monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
## Base Model
ols.1 = lm(total_refusals ~ import_volume + USDA01 + USDAxVolume +  factor(month) + factor(country), data= monthly)
summary(ols.1)
View(monthly)
View(dta)
dta = import_all %>%
dplyr::full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
dplyr::filter(year_month > as.yearmon("2013-12")) %>%
dplyr::filter(year_month < as.yearmon("2020-03")) %>%
dplyr::mutate(USDA_dummy = ifelse(year_month > as.yearmon("2017-09"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
replace_na(list(refusal_count = 0))
dta
#write.csv(dta,"output/build/ez_merged_data.csv")
# Create an interaction variable
dta$USDAxVolume = dta$USDA_dummy * dta$volume_sum
# Add factor(country_name)
OLS.4 <- lm(refusal_count ~ USDA_dummy + volume_sum + USDAxVolume + factor(month) + factor(country_name),
data = dta)
summary(OLS.4, digits = 10)
dta = import_all %>%
dplyr::full_join(refusal_all, by = c("year_month","country_name" = "country_std")) %>%
dplyr::filter(year_month > as.yearmon("2013-12")) %>%
dplyr::filter(year_month < as.yearmon("2020-03")) %>%
dplyr::mutate(USDA_dummy = ifelse(year_month >= as.yearmon("2017-09"), 1, 0),
year = year(year_month),
month = month(year_month)) %>%
replace_na(list(refusal_count = 0))
dta
#write.csv(dta,"output/build/ez_merged_data.csv")
# Create an interaction variable
dta$USDAxVolume = dta$USDA_dummy * dta$volume_sum
# Add factor(country_name)
OLS.4 <- lm(refusal_count ~ USDA_dummy + volume_sum + USDAxVolume + factor(month) + factor(country_name),
data = dta)
summary(OLS.4, digits = 10)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Cleaned import volume data
import = read.csv("output/build/monthly_cleaned.csv")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','total_refusals'))
## Create Year-Month variable for aggregation
import$yrmonth = format(as.Date(paste(import$year,import$month_number,"01", sep="-")),"%Y-%m")
## Aggregate refusals to a monthly level
monthlyVol = setNames(aggregate(import$volume_kg, by=list(import$yrmonth, import$country_name), FUN= sum), c('yrmonth','country','import_volume'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$total_refusals[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$total_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','total_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthlyRef, y= monthlyVol, by= c('yrmonth','country'), all.y= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Month & Year variables
typeof(monthly$yrmonth)
monthly$year = format(as.Date(paste(monthly$yrmonth,'-01',sep= '')), '%Y')
monthly$month = format(as.Date(paste(monthly$yrmonth,'-01',sep = '')), '%m')
typeof(monthly$year)
## Limit data to 2014 (FDA start) to 2020 February (USDA end)
monthly = monthly[monthly$year >= 2014,]
monthly = monthly[!(monthly$year == 2020 & !(monthly$month == '01' | monthly$month == '02')),]
## Dummy Variable if month year is in or after September 2017
monthly$USDA01 = ifelse(((monthly$year == 2017 & (monthly$month == "09" | monthly$month == "10" | monthly$month == "11" | monthly$month == "12"))
| monthly$year >= 2018), 1, 0)
## Interaction of USDA Authority and Volume
monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
monthly$refusalByVolume = monthly$total_refusals / monthly$import_volume
monthly[is.na(monthly)] = 0
monthly$relevantCountries = ifelse((monthly$country == "VIETNAM" | monthly$country == "CHINA" | monthly$country == "THAILAND"), monthly$country, "All Other Countries")
visualize = setNames(aggregate(monthly$refusalByVolume, by=list(monthly$yrmonth, monthly$relevantCountries), FUN= mean), c('yrmonth','country','refusalsByVolume'))
## Base Model
ols.1 = lm(total_refusals ~ import_volume + USDA01 + USDAxVolume +  factor(month) + factor(country), data= monthly)
summary(ols.1)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Cleaned import volume data
import = read.csv("output/build/monthly_cleaned.csv")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal weight to a monthly level
monthlyRef = setNames(aggregate(composite$refusal_weight, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','total_refusal_weight'))
## Create Year-Month variable for aggregation
import$yrmonth = format(as.Date(paste(import$year,import$month_number,"01", sep="-")),"%Y-%m")
## Aggregate refusals to a monthly level
monthlyVol = setNames(aggregate(import$volume_kg, by=list(import$yrmonth, import$country_name), FUN= sum), c('yrmonth','country','import_volume'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$total_refusal_weight), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','total_refusal_weight'))
# Limit to observations with import volume
monthly = merge(x= monthlyRef, y= monthlyVol, by= c('yrmonth','country'), all.y= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Month & Year variables
typeof(monthly$yrmonth)
monthly$year = format(as.Date(paste(monthly$yrmonth,'-01',sep= '')), '%Y')
monthly$month = format(as.Date(paste(monthly$yrmonth,'-01',sep = '')), '%m')
typeof(monthly$year)
## Limit data to 2014 (FDA start) to 2020 February (USDA end)
monthly = monthly[monthly$year >= 2014,]
monthly = monthly[!(monthly$year == 2020 & !(monthly$month == '01' | monthly$month == '02')),]
## Dummy Variable if month year is in or after September 2017
monthly$USDA01 = ifelse(((monthly$year == 2017 & (monthly$month == "09" | monthly$month == "10" | monthly$month == "11" | monthly$month == "12"))
| monthly$year >= 2018), 1, 0)
## Interaction of USDA Authority and Volume
monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
## Base Model
ols.1 = lm(total_refusal_weight ~ import_volume + USDA01 + USDAxVolume +  factor(month) + factor(country), data= monthly)
summary(ols.1)
